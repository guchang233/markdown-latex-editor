function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function r(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s;function l(t,n,o){t.$$.on_destroy.push(function(t,...n){if(null==t){for(const e of n)e(void 0);return e}const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function a(e){return null==e?"":e}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const c="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function d(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode&&e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function h(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function g(e){return document.createTextNode(e)}function f(){return g(" ")}function b(){return g("")}function v(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function x(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function k(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t){e.value=null==t?"":t}function y(e,t,n){for(let o=0;o<e.options.length;o+=1){const n=e.options[o];if(n.__value===t)return void(n.selected=!0)}n&&void 0===t||(e.selectedIndex=-1)}function $(e){const t=e.querySelector(":checked");return t&&t.__value}function j(e,t,n){e.classList.toggle(t,!!n)}let C;function S(e){C=e}function E(){if(!C)throw new Error("Function called outside component initialization");return C}function L(e){E().$$.on_mount.push(e)}function M(){const e=E();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const i=function(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}(t,n,{cancelable:o});return r.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}const _=[],T=[];let B=[];const I=[],z=Promise.resolve();let H=!1;function O(e){B.push(e)}function D(e){I.push(e)}const N=new Set;let A=0;function P(){if(0!==A)return;const e=C;do{try{for(;A<_.length;){const e=_[A];A++,S(e),R(e.$$)}}catch(t){throw _.length=0,A=0,t}for(S(null),_.length=0,A=0;T.length;)T.pop()();for(let e=0;e<B.length;e+=1){const t=B[e];N.has(t)||(N.add(t),t())}B.length=0}while(_.length);for(;I.length;)I.pop()();H=!1,N.clear(),S(e)}function R(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(O)}}const X=new Set;let F;function U(e,t){e&&e.i&&(X.delete(e),e.i(t))}function V(e,t,n,o){if(e&&e.o){if(X.has(e))return;X.add(e),F.c.push((()=>{X.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}function W(e){return void 0!==e?.length?e:Array.from(e)}function q(e,t,n){const o=e.$$.props[t];void 0!==o&&(e.$$.bound[o]=n,n(e.$$.ctx[o]))}function K(e){e&&e.c()}function J(e,n,i){const{fragment:s,after_update:l}=e.$$;s&&s.m(n,i),O((()=>{const n=e.$$.on_mount.map(t).filter(r);e.$$.on_destroy?e.$$.on_destroy.push(...n):o(n),e.$$.on_mount=[]})),l.forEach(O)}function Y(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];B.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),B=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function G(e,t){-1===e.$$.dirty[0]&&(_.push(e),H||(H=!0,z.then(P)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Q(t,r,i,s,l,a,c=null,d=[-1]){const u=C;S(t);const m=t.$$={fragment:null,ctx:[],props:a,update:e,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(u?u.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:r.target||u.$$.root};c&&c(m.root);let h=!1;if(m.ctx=i?i(t,r.props||{},((e,n,...o)=>{const r=o.length?o[0]:n;return m.ctx&&l(m.ctx[e],m.ctx[e]=r)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](r),h&&G(t,e)),n})):[],m.update(),h=!0,o(m.before_update),m.fragment=!!s&&s(m.ctx),r.target){if(r.hydrate){const e=function(e){return Array.from(e.childNodes)}(r.target);m.fragment&&m.fragment.l(e),e.forEach(p)}else m.fragment&&m.fragment.c();r.intro&&U(t.$$.fragment),J(t,r.target,r.anchor),P()}S(u)}class Z{$$=void 0;$$set=void 0;$destroy(){Y(this,1),this.$destroy=e}$on(t,n){if(!r(n))return e;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const e=o.indexOf(n);-1!==e&&o.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const ee=[];function te(t,n=e){let o;const r=new Set;function s(e){if(i(t,e)&&(t=e,o)){const e=!ee.length;for(const n of r)n[1](),ee.push(n,t);if(e){for(let e=0;e<ee.length;e+=2)ee[e][0](ee[e+1]);ee.length=0}}}function l(e){s(e(t))}return{set:s,update:l,subscribe:function(i,a=e){const c=[i,a];return r.add(c),1===r.size&&(o=n(s,l)||e),i(t),()=>{r.delete(c),0===r.size&&o&&(o(),o=null)}}}}let ne,oe;const re=new WeakMap,ie=new WeakMap,se=new WeakMap,le=new WeakMap,ae=new WeakMap;let ce={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ie.get(e);if("objectStoreNames"===t)return e.objectStoreNames||se.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pe(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function de(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(oe||(oe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(me(this),t),pe(re.get(this))}:function(...t){return pe(e.apply(me(this),t))}:function(t,...n){const o=e.call(me(this),t,...n);return se.set(o,t.sort?t.sort():[t]),pe(o)}}function ue(e){return"function"==typeof e?de(e):(e instanceof IDBTransaction&&function(e){if(ie.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),o()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));ie.set(e,t)}(e),t=e,(ne||(ne=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,ce):e);var t}function pe(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(pe(e.result)),o()},i=()=>{n(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&re.set(t,e)})).catch((()=>{})),ae.set(t,e),t}(e);if(le.has(e))return le.get(e);const t=ue(e);return t!==e&&(le.set(e,t),ae.set(t,e)),t}const me=e=>ae.get(e);const he=["get","getKey","getAll","getAllKeys","count"],ge=["put","add","delete","clear"],fe=new Map;function be(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(fe.get(t))return fe.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=ge.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!he.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let s=i.store;return o&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),r&&i.done]))[0]};return fe.set(t,i),i}ce=(e=>({...e,get:(t,n,o)=>be(t,n)||e.get(t,n,o),has:(t,n)=>!!be(t,n)||e.has(t,n)}))(ce);const ve=(async()=>function(e,t,{blocked:n,upgrade:o,blocking:r,terminated:i}={}){const s=indexedDB.open(e,t),l=pe(s);return o&&s.addEventListener("upgradeneeded",(e=>{o(pe(s.result),e.oldVersion,e.newVersion,pe(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),l.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),l}("marktex-editor",1,{upgrade(e){e.createObjectStore("documents",{keyPath:"id"}).createIndex("timestamp","timestamp"),e.createObjectStore("versions",{keyPath:"id",autoIncrement:!0})}}))(),xe=(()=>{const e={currentContent:'# Welcome to MarkTeX Editor\n\nThis is a **high-performance** Markdown and LaTeX editor.\n\n## Features\n\n- Real-time preview\n- Markdown syntax highlighting\n- LaTeX math rendering: $E = mc^2$\n- Code highlighting\n\n```javascript\nconsole.log("Hello, world!");\n```\n\n## Math Example\n\n$$\n\\int_{a}^{b} f(x) \\, dx = F(b) - F(a)\n$$\n\n## Table Example\n\n| Header 1 | Header 2 | Header 3 |\n|----------|----------|----------|\n| Cell 1   | Cell 2   | Cell 3   |\n| Cell 4   | Cell 5   | Cell 6   |\n\n## Task List\n\n- [x] Create editor\n- [ ] Add more features\n- [ ] Release to the world\n',isSaving:!1,lastSaved:null,versions:[]},{subscribe:t,update:n,set:o}=te(e),r=((e,t=500)=>{let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}})((async e=>{n((e=>({...e,isSaving:!0})));try{const t=Date.now(),o=await ve,r=o.transaction("documents","readwrite").objectStore("documents");await r.put({id:"current",content:e,timestamp:t});const i=o.transaction("versions","readwrite").objectStore("versions");await i.add({content:e,timestamp:t});const s=await i.getAll();if(s.length>10){const e=s.sort(((e,t)=>t.timestamp-e.timestamp)),t=e.slice(10).map((e=>i.delete(e.id)));await Promise.all(t)}const l=(await i.getAll()).sort(((e,t)=>t.timestamp-e.timestamp)).slice(0,10);n((e=>({...e,isSaving:!1,lastSaved:t,versions:l})))}catch(t){console.error("Failed to save document:",t),n((e=>({...e,isSaving:!1})))}}));return{subscribe:t,updateContent:e=>{n((t=>({...t,currentContent:e}))),r(e)},loadDocument:async()=>{try{const t=await ve,r=t.transaction("documents","readonly").objectStore("documents"),i=await r.get("current");i&&o({...e,currentContent:i.content,lastSaved:i.timestamp});const s=t.transaction("versions","readonly").objectStore("versions"),l=(await s.getAll()).sort(((e,t)=>t.timestamp-e.timestamp)).slice(0,10);n((e=>({...e,versions:l})))}catch(t){console.error("Failed to load document:",t)}},restoreVersion:async e=>{try{const t=await ve,o=t.transaction("versions","readonly").objectStore("versions"),i=await o.get(e);i&&(n((e=>({...e,currentContent:i.content}))),r(i.content))}catch(t){console.error("Failed to restore version:",t)}},exportDocument:()=>new Promise(((e,t)=>{n((t=>(e(t.currentContent),t)))}))}})();function ke(e){try{console.log("开始渲染Markdown，长度:",e.length);const n={};let o=0,r=e.replace(/\$\$([\s\S]*?)\$\$/g,((e,t)=>{const r=`__LATEX_BLOCK_${o++}__`;return n[r]=e,r}));r=r.replace(/\$([^\$\n]+?)\$/g,((e,t)=>{const r=`__LATEX_INLINE_${o++}__`;return n[r]=e,r})),console.log("处理Markdown文本，长度:",r.length);let i=function(e){e=function(e){const t=e.split("\n");let n=!1,o=[],r=[];console.log("原始文本行数:",t.length);for(let i=0;i<t.length;i++){const e=t[i];if(e.trim().includes("|"))n?o.push(e):i+1<t.length&&t[i+1].includes("|")&&t[i+1].includes("-")?(n=!0,o=[e],console.log("检测到表格开始:",e)):r.push(e);else{if(n){if(o.length>=2){const e=we(o);r.push(e),console.log("表格行数:",o.length,"转换后HTML:",e.substring(0,50)+"...")}else r=r.concat(o);n=!1,o=[]}r.push(e)}}if(n&&o.length>=2){const e=we(o);r.push(e),console.log("文末表格行数:",o.length,"转换后HTML:",e.substring(0,50)+"...")}else n&&(r=r.concat(o));return r.join("\n")}(e),e=e.replace(/```([^`]*?)```/gs,((e,t)=>`<pre class="code-block"><code>${t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`));const t=[];let n=0;function o(e){const o=`__HTML_TAG_${n++}__`;return t.push({placeholder:o,content:e}),o}e=e.replace(/<div class="table-container">[\s\S]*?<\/div>/g,o);let r=e.replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>");return r=r.replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>").replace(/\*(.*?)\*/gim,"<em>$1</em>").replace(/~~(.*?)~~/gim,"<del>$1</del>").replace(/`([^`]+)`/gim,'<code class="code-inline">$1</code>'),r=r.replace(/\[([^\]]+)\]\(([^)]+)\)/gim,'<a href="$2">$1</a>'),r=r.replace(/!\[([^\]]+)\]\(([^)]+)\)/gim,'<img src="$2" alt="$1">'),r=r.replace(/^\s*\*\s(.*$)/gim,"<li>$1</li>").replace(/^\s*-\s(.*$)/gim,"<li>$1</li>").replace(/^\s*\d+\.\s(.*$)/gim,"<li>$1</li>"),r=r.replace(/<li>(.+)<\/li>\n<li>/gim,"<li>$1</li>\n<li>").replace(/(<li>(.+)<\/li>\n)+/gim,"<ul>$&</ul>"),r=r.replace(/<li>\[\s\] (.*?)<\/li>/gim,'<li class="task-list-item"><input type="checkbox" disabled> $1</li>').replace(/<li>\[x\] (.*?)<\/li>/gim,'<li class="task-list-item"><input type="checkbox" checked disabled> $1</li>'),r=r.replace(/\n/gim,"<br>"),t.forEach((e=>{r=r.replace(e.placeholder,e.content)})),r}(r);if(console.log("Markdown处理完成，HTML长度:",i.length),"undefined"!=typeof window&&window.katex){const e=window.katex;for(let r=0;r<o;r++){const o=`__LATEX_BLOCK_${r}__`,s=`__LATEX_INLINE_${r}__`;if(i.includes(o)){const r=n[o],s=r.replace(/^\$\$([\s\S]*?)\$\$$/g,"$1");try{const t=e.renderToString(s,{throwOnError:!1,displayMode:!0});i=i.replace(o,t)}catch(t){console.error("块级LaTeX渲染错误:",t),i=i.replace(o,`<div class="latex-error" title="${t instanceof Error?t.message:"Unknown error"}">${r}</div>`)}}if(i.includes(s)){const o=n[s],r=o.replace(/^\$([^\$]+)\$$/g,"$1");try{const t=e.renderToString(r,{throwOnError:!1,displayMode:!1});i=i.replace(s,t)}catch(t){console.error("内联LaTeX渲染错误:",t),i=i.replace(s,`<span class="latex-error" title="${t instanceof Error?t.message:"Unknown error"}">${o}</span>`)}}}}else{for(const[e,t]of Object.entries(n))e.startsWith("__LATEX_BLOCK_")?i=i.replace(e,`<div class="math-block">${t}</div>`):e.startsWith("__LATEX_INLINE_")&&(i=i.replace(e,`<span class="math-inline">${t}</span>`));console.warn("KaTeX库不可用，使用备用渲染方式。请确保已加载KaTeX。")}const s=i.substring(0,200)+(i.length>200?"...":"");return console.log("渲染结果预览:",s),i}catch(t){return console.error("Markdown渲染错误:",t),`<div class="error">Error rendering markdown: ${t instanceof Error?t.message:"Unknown error"}</div>`}}function we(e){if(e.length<2)return e.join("\n");console.log("转换表格, 行数:",e.length);const t=e[0];e[1];const n=e.slice(2);function o(e){let t=e.trim();return t.startsWith("|")&&(t=t.substring(1)),t.endsWith("|")&&(t=t.substring(0,t.length-1)),t.split("|").map((e=>e.trim()))}const r=o(t),i=r.length;let s='<div class="table-container">\n<table class="md-table">\n<thead>\n<tr>\n';for(const l of r)s+=`  <th>${l}</th>\n`;s+="</tr>\n</thead>\n<tbody>\n";for(const l of n){const e=o(l);for(;e.length<i;)e.push("");s+="<tr>\n";for(const t of e.slice(0,i))s+=`  <td>${t}</td>\n`;s+="</tr>\n"}return s+="</tbody>\n</table>\n</div>",console.log("生成HTML表格，列数:",i),s}function ye(e,t,n){const o=e.slice();return o[5]=t[n],o}function $e(e){let t;return{c(){t=m("div"),t.innerHTML='<div class="w-3 h-3 rounded-full bg-green-500"></div> <span>编辑器就绪</span>',x(t,"class","editor-ready-indicator toolbar-status py-1 px-3 text-sm flex items-center gap-1 mr-2 svelte-t69619")},m(e,n){u(e,t,n)},d(e){e&&p(t)}}}function je(e){let t;return{c(){t=m("div"),t.innerHTML='<div class="w-3 h-3 rounded-full bg-red-500 animate-pulse svelte-t69619"></div> <span>编辑器加载中...</span>',x(t,"class","editor-loading-indicator toolbar-status py-1 px-3 text-sm flex items-center gap-1 mr-2 svelte-t69619")},m(e,n){u(e,t,n)},d(e){e&&p(t)}}}function Ce(e){let t,n,o,r,i,s,l,a=function(e){switch(e){case"bold":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path></svg>';case"italic":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="4" x2="10" y2="4"></line><line x1="14" y1="20" x2="5" y2="20"></line><line x1="15" y1="4" x2="9" y2="20"></line></svg>';case"strikethrough":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.3 5H6.7a2.7 2.7 0 0 0-2.7 2.7v8.6a2.7 2.7 0 0 0 2.7 2.7h10.6a2.7 2.7 0 0 0 2.7-2.7V7.7A2.7 2.7 0 0 0 17.3 5z"/><line x1="4" y1="12" x2="20" y2="12"/></svg>';case"code":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';case"link":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>';case"image":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>';case"table":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3zM3 9h18M3 15h18M9 3v18M15 3v18"></path></svg>';case"function":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 9h14M5 15h14M9 5v14M15 5v14"/></svg>';case"list":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>';case"list-ordered":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><path d="M4 6h1v4"></path><path d="M4 10h2"></path><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path></svg>';case"check-square":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>';case"heading":return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 12h12"></path><path d="M6 20V4"></path><path d="M18 20V4"></path></svg>';default:return'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg>'}}(e[5].icon)+"";function c(){return e[3](e[5])}return{c(){t=m("button"),n=m("span"),o=f(),x(n,"class","flex items-center justify-center w-5 h-5"),x(n,"aria-hidden","true"),x(t,"type","button"),x(t,"class","toolbar-button p-2 hover:bg-base-300 dark:hover:bg-base-300-dark rounded-md transition-colors duration-150 svelte-t69619"),x(t,"title",r=e[0]?e[5].tooltip:"编辑器加载中..."),t.disabled=i=!e[0],j(t,"disabled",!e[0])},m(e,r){u(e,t,r),d(t,n),n.innerHTML=a,d(t,o),s||(l=v(t,"click",c),s=!0)},p(n,o){e=n,1&o&&r!==(r=e[0]?e[5].tooltip:"编辑器加载中...")&&x(t,"title",r),1&o&&i!==(i=!e[0])&&(t.disabled=i),1&o&&j(t,"disabled",!e[0])},d(e){e&&p(t),s=!1,l()}}}function Se(t){let n,o;function r(e,t){return e[0]?$e:je}let i=r(t),s=i(t),l=W(t[1]),a=[];for(let e=0;e<l.length;e+=1)a[e]=Ce(ye(t,l,e));return{c(){n=m("div"),s.c(),o=f();for(let e=0;e<a.length;e+=1)a[e].c();x(n,"class","flex items-center gap-2 p-2 bg-base-200 dark:bg-base-200-dark rounded-lg shadow-sm overflow-x-auto")},m(e,t){u(e,n,t),s.m(n,null),d(n,o);for(let o=0;o<a.length;o+=1)a[o]&&a[o].m(n,null)},p(e,[t]){if(i!==(i=r(e))&&(s.d(1),s=i(e),s&&(s.c(),s.m(n,o))),7&t){let o;for(l=W(e[1]),o=0;o<l.length;o+=1){const r=ye(e,l,o);a[o]?a[o].p(r,t):(a[o]=Ce(r),a[o].c(),a[o].m(n,null))}for(;o<a.length;o+=1)a[o].d(1);a.length=l.length}},i:e,o:e,d(e){e&&p(n),s.d(),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(a,e)}}}function Ee(e,t,n){let{editorReady:o=!1}=t;const r=M();L((()=>{console.log("[MarkdownToolbar] 组件挂载完成, editorReady =",o)}));function i(e,t){if(o)console.log("[MarkdownToolbar] 按钮点击:",e),r("action",{action:e,placeholder:t});else{console.log("[MarkdownToolbar] 编辑器未就绪，忽略操作:",e);!function(e,t,n="info"){const o=document.createElement("div"),r="warning"===n?"bg-yellow-100 dark:bg-yellow-900":"error"===n?"bg-red-100 dark:bg-red-900":"bg-blue-100 dark:bg-blue-900",i="warning"===n?"text-yellow-800 dark:text-yellow-200":"error"===n?"text-red-800 dark:text-red-200":"text-blue-800 dark:text-blue-200";o.className=`${r} ${i} px-4 py-2 rounded-lg shadow-md text-sm max-w-xs animate-fade-in`,o.innerHTML=t,e.appendChild(o),setTimeout((()=>{o.classList.add("animate-fade-out"),setTimeout((()=>o.remove()),300)}),3e3)}(document.querySelector(".notification-container")||function(){const e=document.createElement("div");return e.className="notification-container fixed top-4 right-4 z-50 flex flex-col gap-2",document.body.appendChild(e),e}(),"编辑器尚未完全加载，请稍候再试","warning")}}return e.$$set=e=>{"editorReady"in e&&n(0,o=e.editorReady)},e.$$.update=()=>{1&e.$$.dirty&&console.log("[MarkdownToolbar] editorReady changed to:",o)},[o,[{id:"bold",tooltip:"Bold (Ctrl+B)",placeholder:"**Bold**",icon:"bold"},{id:"italic",tooltip:"Italic (Ctrl+I)",placeholder:"*Italic*",icon:"italic"},{id:"strikethrough",tooltip:"Strikethrough",placeholder:"~~Strikethrough~~",icon:"strikethrough"},{id:"code",tooltip:"Code (Ctrl+K)",placeholder:"`Code`",icon:"code"},{id:"link",tooltip:"Link",placeholder:"[Link](https://example.com)",icon:"link"},{id:"image",tooltip:"Image",placeholder:"![Alt text](https://example.com/image.jpg)",icon:"image"},{id:"table",tooltip:"Table",placeholder:"| Header | Header |\n| ------ | ------ |\n| Cell   | Cell   |",icon:"table"},{id:"formula",tooltip:"Math Formula",placeholder:"$E = mc^2$",icon:"function"},{id:"bulletList",tooltip:"Bulleted List",placeholder:"- List item\n- Another item",icon:"list"},{id:"numberedList",tooltip:"Numbered List",placeholder:"1. First item\n2. Second item",icon:"list-ordered"},{id:"taskList",tooltip:"Task List",placeholder:"- [ ] Todo item\n- [x] Completed item",icon:"check-square"},{id:"heading",tooltip:"Heading",placeholder:"## Heading",icon:"heading"}],i,e=>i(e.id,e.placeholder)]}class Le extends Z{constructor(e){super(),Q(this,e,Ee,Se,i,{editorReady:0})}}const Me={fontSize:14,lineHeight:1.6,tabSize:2,showLineNumbers:!0,autoSave:!0,autoSaveInterval:30,syncScroll:!0,livePreview:!0,showCodeBackground:!0,showMathBackground:!1,shortcutsEnabled:!0};const _e=te(function(){try{const e=localStorage.getItem("marktex-settings");if(e)return{...Me,...JSON.parse(e)}}catch(e){console.error("无法加载设置:",e)}return Me}());function Te(e,t){_e.update((n=>({...n,[e]:t})))}_e.subscribe((e=>{try{localStorage.setItem("marktex-settings",JSON.stringify(e))}catch(t){console.error("无法保存设置:",t)}}));function Be(e){let t,n,r,i,s,l,a,c,h,g,b,k,w,y,$,C,S,E,L,M,_,T,B,I,z;function H(e,t){return"appearance"===e[1]?Oe:"editor"===e[1]?He:"autosave"===e[1]?ze:"preview"===e[1]?Ie:void 0}let O=H(e),D=O&&O(e);return{c(){t=m("div"),n=f(),r=m("div"),i=m("header"),s=m("h2"),s.textContent="编辑器设置",l=f(),a=m("button"),a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',c=f(),h=m("div"),g=m("button"),g.textContent="外观",b=f(),k=m("button"),k.textContent="编辑器",w=f(),y=m("button"),y.textContent="自动保存",$=f(),C=m("button"),C.textContent="预览",S=f(),E=m("div"),D&&D.c(),L=f(),M=m("div"),_=m("button"),_.textContent="重置为默认值",T=f(),B=m("button"),B.textContent="完成",x(t,"class","settings-dialog-overlay svelte-n6orji"),x(s,"class","svelte-n6orji"),x(a,"class","close-button svelte-n6orji"),x(a,"aria-label","关闭设置"),x(i,"class","settings-dialog-header svelte-n6orji"),x(g,"class","tab svelte-n6orji"),j(g,"active","appearance"===e[1]),x(k,"class","tab svelte-n6orji"),j(k,"active","editor"===e[1]),x(y,"class","tab svelte-n6orji"),j(y,"active","autosave"===e[1]),x(C,"class","tab svelte-n6orji"),j(C,"active","preview"===e[1]),x(h,"class","tabs svelte-n6orji"),x(E,"class","settings-content svelte-n6orji"),x(_,"class","reset-button svelte-n6orji"),x(B,"class","done-button svelte-n6orji"),x(M,"class","settings-actions svelte-n6orji"),x(r,"class","settings-dialog svelte-n6orji")},m(o,p){u(o,t,p),u(o,n,p),u(o,r,p),d(r,i),d(i,s),d(i,l),d(i,a),d(r,c),d(r,h),d(h,g),d(h,b),d(h,k),d(h,w),d(h,y),d(h,$),d(h,C),d(r,S),d(r,E),D&&D.m(E,null),d(r,L),d(r,M),d(M,_),d(M,T),d(M,B),I||(z=[v(t,"click",e[3]),v(a,"click",e[3]),v(g,"click",e[8]),v(k,"click",e[9]),v(y,"click",e[10]),v(C,"click",e[11]),v(_,"click",e[6]),v(B,"click",e[3])],I=!0)},p(e,t){2&t&&j(g,"active","appearance"===e[1]),2&t&&j(k,"active","editor"===e[1]),2&t&&j(y,"active","autosave"===e[1]),2&t&&j(C,"active","preview"===e[1]),O===(O=H(e))&&D?D.p(e,t):(D&&D.d(1),D=O&&O(e),D&&(D.c(),D.m(E,null)))},d(e){e&&(p(t),p(n),p(r)),D&&D.d(),I=!1,o(z)}}}function Ie(e){let t,n,r,i,s,l,a,c,h,g,b,k,w,y,$,j,C,S,E,L,M,_,T,B,I,z,H,O,D,N,A,P;return{c(){t=m("section"),n=m("h3"),n.textContent="预览设置",r=f(),i=m("div"),s=m("label"),l=m("input"),c=f(),h=m("span"),h.textContent="同步滚动",g=f(),b=m("div"),k=m("label"),w=m("input"),$=f(),j=m("span"),j.textContent="实时预览",C=f(),S=m("div"),E=m("label"),L=m("input"),_=f(),T=m("span"),T.textContent="显示代码块背景",B=f(),I=m("div"),z=m("label"),H=m("input"),D=f(),N=m("span"),N.textContent="显示公式块背景",x(n,"class","svelte-n6orji"),x(l,"type","checkbox"),x(l,"id","syncScroll"),l.checked=a=e[2].syncScroll,x(l,"class","svelte-n6orji"),x(s,"for","syncScroll"),x(s,"class","svelte-n6orji"),x(i,"class","setting-item checkbox svelte-n6orji"),x(w,"type","checkbox"),x(w,"id","livePreview"),w.checked=y=e[2].livePreview,x(w,"class","svelte-n6orji"),x(k,"for","livePreview"),x(k,"class","svelte-n6orji"),x(b,"class","setting-item checkbox svelte-n6orji"),x(L,"type","checkbox"),x(L,"id","showCodeBackground"),L.checked=M=e[2].showCodeBackground,x(L,"class","svelte-n6orji"),x(E,"for","showCodeBackground"),x(E,"class","svelte-n6orji"),x(S,"class","setting-item checkbox svelte-n6orji"),x(H,"type","checkbox"),x(H,"id","showMathBackground"),H.checked=O=e[2].showMathBackground,x(H,"class","svelte-n6orji"),x(z,"for","showMathBackground"),x(z,"class","svelte-n6orji"),x(I,"class","setting-item checkbox svelte-n6orji"),x(t,"class","settings-section svelte-n6orji")},m(o,a){u(o,t,a),d(t,n),d(t,r),d(t,i),d(i,s),d(s,l),d(s,c),d(s,h),d(t,g),d(t,b),d(b,k),d(k,w),d(k,$),d(k,j),d(t,C),d(t,S),d(S,E),d(E,L),d(E,_),d(E,T),d(t,B),d(t,I),d(I,z),d(z,H),d(z,D),d(z,N),A||(P=[v(l,"change",e[19]),v(w,"change",e[20]),v(L,"change",e[21]),v(H,"change",e[22])],A=!0)},p(e,t){4&t&&a!==(a=e[2].syncScroll)&&(l.checked=a),4&t&&y!==(y=e[2].livePreview)&&(w.checked=y),4&t&&M!==(M=e[2].showCodeBackground)&&(L.checked=M),4&t&&O!==(O=e[2].showMathBackground)&&(H.checked=O)},d(e){e&&p(t),A=!1,o(P)}}}function ze(e){let t,n,r,i,s,l,a,c,h,b,w,y,$,j,C,S,E,L,M,_,T,B,I,z=e[2].autoSaveInterval+"";return{c(){t=m("section"),n=m("h3"),n.textContent="自动保存设置",r=f(),i=m("div"),s=m("label"),l=m("input"),c=f(),h=m("span"),h.textContent="启用自动保存",b=f(),w=m("div"),y=m("label"),y.textContent="自动保存间隔（秒）",$=f(),j=m("div"),C=m("input"),L=f(),M=m("span"),_=g(z),T=g(" 秒"),x(n,"class","svelte-n6orji"),x(l,"type","checkbox"),x(l,"id","autoSave"),l.checked=a=e[2].autoSave,x(l,"class","svelte-n6orji"),x(s,"for","autoSave"),x(s,"class","svelte-n6orji"),x(i,"class","setting-item checkbox svelte-n6orji"),x(y,"for","autoSaveInterval"),x(y,"class","svelte-n6orji"),x(C,"type","range"),x(C,"id","autoSaveInterval"),x(C,"min","5"),x(C,"max","300"),x(C,"step","5"),C.value=S=e[2].autoSaveInterval,C.disabled=E=!e[2].autoSave,x(C,"class","svelte-n6orji"),x(M,"class","value-display svelte-n6orji"),x(j,"class","setting-control svelte-n6orji"),x(w,"class","setting-item svelte-n6orji"),x(t,"class","settings-section svelte-n6orji")},m(o,a){u(o,t,a),d(t,n),d(t,r),d(t,i),d(i,s),d(s,l),d(s,c),d(s,h),d(t,b),d(t,w),d(w,y),d(w,$),d(w,j),d(j,C),d(j,L),d(j,M),d(M,_),d(M,T),B||(I=[v(l,"change",e[17]),v(C,"input",e[18])],B=!0)},p(e,t){4&t&&a!==(a=e[2].autoSave)&&(l.checked=a),4&t&&S!==(S=e[2].autoSaveInterval)&&(C.value=S),4&t&&E!==(E=!e[2].autoSave)&&(C.disabled=E),4&t&&z!==(z=e[2].autoSaveInterval+"")&&k(_,z)},d(e){e&&p(t),B=!1,o(I)}}}function He(e){let t,n,r,i,s,l,a,c,h,b,w,y,$,j,C,S,E,L,M,_,T,B,I=e[2].tabSize+"";return{c(){t=m("section"),n=m("h3"),n.textContent="编辑器设置",r=f(),i=m("div"),s=m("label"),s.textContent="制表符大小",l=f(),a=m("div"),c=m("input"),b=f(),w=m("span"),y=g(I),$=g(" 个空格"),j=f(),C=m("div"),S=m("label"),E=m("input"),M=f(),_=m("span"),_.textContent="启用快捷键",x(n,"class","svelte-n6orji"),x(s,"for","tabSize"),x(s,"class","svelte-n6orji"),x(c,"type","range"),x(c,"id","tabSize"),x(c,"min","2"),x(c,"max","8"),x(c,"step","2"),c.value=h=e[2].tabSize,x(c,"class","svelte-n6orji"),x(w,"class","value-display svelte-n6orji"),x(a,"class","setting-control svelte-n6orji"),x(i,"class","setting-item svelte-n6orji"),x(E,"type","checkbox"),x(E,"id","shortcutsEnabled"),E.checked=L=e[2].shortcutsEnabled,x(E,"class","svelte-n6orji"),x(S,"for","shortcutsEnabled"),x(S,"class","svelte-n6orji"),x(C,"class","setting-item checkbox svelte-n6orji"),x(t,"class","settings-section svelte-n6orji")},m(o,p){u(o,t,p),d(t,n),d(t,r),d(t,i),d(i,s),d(i,l),d(i,a),d(a,c),d(a,b),d(a,w),d(w,y),d(w,$),d(t,j),d(t,C),d(C,S),d(S,E),d(S,M),d(S,_),T||(B=[v(c,"input",e[15]),v(E,"change",e[16])],T=!0)},p(e,t){4&t&&h!==(h=e[2].tabSize)&&(c.value=h),4&t&&I!==(I=e[2].tabSize+"")&&k(y,I),4&t&&L!==(L=e[2].shortcutsEnabled)&&(E.checked=L)},d(e){e&&p(t),T=!1,o(B)}}}function Oe(e){let t,n,r,i,s,l,a,c,h,b,w,y,$,j,C,S,E,L,M,_,T,B,I,z,H,O,D,N,A,P,R,X,F=e[2].fontSize+"",U=e[2].lineHeight+"";return{c(){t=m("section"),n=m("h3"),n.textContent="外观设置",r=f(),i=m("div"),s=m("label"),s.textContent="字体大小",l=f(),a=m("div"),c=m("input"),b=f(),w=m("span"),y=g(F),$=g("px"),j=f(),C=m("div"),S=m("label"),S.textContent="行高",E=f(),L=m("div"),M=m("input"),T=f(),B=m("span"),I=g(U),z=f(),H=m("div"),O=m("label"),D=m("input"),A=f(),P=m("span"),P.textContent="显示行号",x(n,"class","svelte-n6orji"),x(s,"for","fontSize"),x(s,"class","svelte-n6orji"),x(c,"type","range"),x(c,"id","fontSize"),x(c,"min","10"),x(c,"max","24"),x(c,"step","1"),c.value=h=e[2].fontSize,x(c,"class","svelte-n6orji"),x(w,"class","value-display svelte-n6orji"),x(a,"class","setting-control svelte-n6orji"),x(i,"class","setting-item svelte-n6orji"),x(S,"for","lineHeight"),x(S,"class","svelte-n6orji"),x(M,"type","range"),x(M,"id","lineHeight"),x(M,"min","1"),x(M,"max","3"),x(M,"step","0.1"),M.value=_=e[2].lineHeight,x(M,"class","svelte-n6orji"),x(B,"class","value-display svelte-n6orji"),x(L,"class","setting-control svelte-n6orji"),x(C,"class","setting-item svelte-n6orji"),x(D,"type","checkbox"),x(D,"id","showLineNumbers"),D.checked=N=e[2].showLineNumbers,x(D,"class","svelte-n6orji"),x(O,"for","showLineNumbers"),x(O,"class","svelte-n6orji"),x(H,"class","setting-item checkbox svelte-n6orji"),x(t,"class","settings-section svelte-n6orji")},m(o,p){u(o,t,p),d(t,n),d(t,r),d(t,i),d(i,s),d(i,l),d(i,a),d(a,c),d(a,b),d(a,w),d(w,y),d(w,$),d(t,j),d(t,C),d(C,S),d(C,E),d(C,L),d(L,M),d(L,T),d(L,B),d(B,I),d(t,z),d(t,H),d(H,O),d(O,D),d(O,A),d(O,P),R||(X=[v(c,"input",e[12]),v(M,"input",e[13]),v(D,"change",e[14])],R=!0)},p(e,t){4&t&&h!==(h=e[2].fontSize)&&(c.value=h),4&t&&F!==(F=e[2].fontSize+"")&&k(y,F),4&t&&_!==(_=e[2].lineHeight)&&(M.value=_),4&t&&U!==(U=e[2].lineHeight+"")&&k(I,U),4&t&&N!==(N=e[2].showLineNumbers)&&(D.checked=N)},d(e){e&&p(t),R=!1,o(X)}}}function De(t){let n,o=t[0]&&Be(t);return{c(){o&&o.c(),n=b()},m(e,t){o&&o.m(e,t),u(e,n,t)},p(e,[t]){e[0]?o?o.p(e,t):(o=Be(e),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:e,o:e,d(e){e&&p(n),o&&o.d(e)}}}function Ne(e,t,n){let o;l(e,_e,(e=>n(2,o=e)));let{isOpen:r=!1}=t;function i(e){Te(e,!o[e])}function s(e,t){Te(e,parseInt(t,10))}let a="appearance";function c(e){n(1,a=e)}return e.$$set=e=>{"isOpen"in e&&n(0,r=e.isOpen)},[r,a,o,function(){n(0,r=!1)},i,s,function(){_e.set({...Me})},c,()=>c("appearance"),()=>c("editor"),()=>c("autosave"),()=>c("preview"),e=>s("fontSize",e.target.value),e=>s("lineHeight",e.target.value),()=>i("showLineNumbers"),e=>s("tabSize",e.target.value),()=>i("shortcutsEnabled"),()=>i("autoSave"),e=>s("autoSaveInterval",e.target.value),()=>i("syncScroll"),()=>i("livePreview"),()=>i("showCodeBackground"),()=>i("showMathBackground")]}class Ae extends Z{constructor(e){super(),Q(this,e,Ne,De,i,{isOpen:0})}}function Pe(e){let t,n,r,i,s,l,c,h,b,k,y,$,j,C,S,E,L,M,_,T,B,I,z,H,O,D,N,A,P,R,X,F,U,V,W,q,K,J,Y,G,Q,Z,ee,te,ne,oe,re,ie,se="pdf"===e[1]&&Re(e),le=("html"===e[1]||"pdf"===e[1])&&Xe(e);return{c(){t=m("div"),n=m("div"),r=m("div"),i=m("h2"),i.textContent="导出设置",s=f(),l=m("button"),l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',c=f(),h=m("div"),b=m("div"),k=m("label"),k.textContent="导出格式",y=f(),$=m("div"),j=m("button"),C=g("Markdown"),E=f(),L=m("button"),M=g("HTML"),T=f(),B=m("button"),I=g("PDF"),H=f(),O=m("div"),D=m("label"),D.textContent="文件名",N=f(),A=m("input"),P=f(),R=m("div"),X=m("div"),F=m("input"),U=f(),V=m("label"),V.textContent="包含样式",W=f(),q=m("div"),K=m("input"),J=f(),Y=m("label"),Y.textContent="包含目录",G=f(),se&&se.c(),Q=f(),le&&le.c(),Z=f(),ee=m("div"),te=m("button"),te.textContent="取消",ne=f(),oe=m("button"),oe.textContent="导出",x(i,"class","text-xl font-bold text-gray-900 dark:text-white"),x(l,"class","text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"),x(r,"class","flex justify-between items-center mb-6"),x(k,"class","block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"),x(j,"class",S=a(`py-2 px-4 rounded-md border ${"markdown"===e[1]?"bg-blue-100 border-blue-500 dark:bg-blue-900 dark:border-blue-400 font-medium":"border-gray-300 dark:border-gray-600"} transition-colors`)+" svelte-1oul5gf"),x(L,"class",_=a(`py-2 px-4 rounded-md border ${"html"===e[1]?"bg-blue-100 border-blue-500 dark:bg-blue-900 dark:border-blue-400 font-medium":"border-gray-300 dark:border-gray-600"} transition-colors`)+" svelte-1oul5gf"),x(B,"class",z=a(`py-2 px-4 rounded-md border ${"pdf"===e[1]?"bg-blue-100 border-blue-500 dark:bg-blue-900 dark:border-blue-400 font-medium":"border-gray-300 dark:border-gray-600"} transition-colors`)+" svelte-1oul5gf"),x($,"class","grid grid-cols-3 gap-3"),x(D,"for","filename"),x(D,"class","block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"),x(A,"type","text"),x(A,"id","filename"),x(A,"class","w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"),x(F,"type","checkbox"),x(F,"id","includeStyles"),x(F,"class","h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"),x(V,"for","includeStyles"),x(V,"class","ml-2 block text-sm text-gray-700 dark:text-gray-300"),x(X,"class","flex items-center"),x(K,"type","checkbox"),x(K,"id","includeToc"),x(K,"class","h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"),x(Y,"for","includeToc"),x(Y,"class","ml-2 block text-sm text-gray-700 dark:text-gray-300"),x(q,"class","flex items-center"),x(R,"class","space-y-3 py-2"),x(h,"class","space-y-5"),x(te,"class","mr-3 px-5 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"),x(oe,"class","px-5 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none transition-colors"),x(ee,"class","mt-8 flex justify-end"),x(n,"class","bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-8 max-h-[90vh] overflow-y-auto"),x(t,"class","fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center svelte-1oul5gf")},m(o,a){var p;u(o,t,a),d(t,n),d(n,r),d(r,i),d(r,s),d(r,l),d(n,c),d(n,h),d(h,b),d(b,k),d(b,y),d(b,$),d($,j),d(j,C),d($,E),d($,L),d(L,M),d($,T),d($,B),d(B,I),d(h,H),d(h,O),d(O,D),d(O,N),d(O,A),w(A,e[3]),d(h,P),d(h,R),d(R,X),d(X,F),F.checked=e[2],d(X,U),d(X,V),d(R,W),d(R,q),d(q,K),K.checked=e[4],d(q,J),d(q,Y),d(h,G),se&&se.m(h,null),d(h,Q),le&&le.m(h,null),d(n,Z),d(n,ee),d(ee,te),d(ee,ne),d(ee,oe),re||(ie=[v(l,"click",e[7]),v(j,"click",e[10]),v(L,"click",e[11]),v(B,"click",e[12]),v(A,"input",e[13]),v(F,"change",e[14]),v(K,"change",e[15]),v(te,"click",e[7]),v(oe,"click",e[8]),v(t,"click",(p=e[7],function(e){e.target===this&&p.call(this,e)}))],re=!0)},p(e,t){2&t&&S!==(S=a(`py-2 px-4 rounded-md border ${"markdown"===e[1]?"bg-blue-100 border-blue-500 dark:bg-blue-900 dark:border-blue-400 font-medium":"border-gray-300 dark:border-gray-600"} transition-colors`)+" svelte-1oul5gf")&&x(j,"class",S),2&t&&_!==(_=a(`py-2 px-4 rounded-md border ${"html"===e[1]?"bg-blue-100 border-blue-500 dark:bg-blue-900 dark:border-blue-400 font-medium":"border-gray-300 dark:border-gray-600"} transition-colors`)+" svelte-1oul5gf")&&x(L,"class",_),2&t&&z!==(z=a(`py-2 px-4 rounded-md border ${"pdf"===e[1]?"bg-blue-100 border-blue-500 dark:bg-blue-900 dark:border-blue-400 font-medium":"border-gray-300 dark:border-gray-600"} transition-colors`)+" svelte-1oul5gf")&&x(B,"class",z),8&t&&A.value!==e[3]&&w(A,e[3]),4&t&&(F.checked=e[2]),16&t&&(K.checked=e[4]),"pdf"===e[1]?se?se.p(e,t):(se=Re(e),se.c(),se.m(h,Q)):se&&(se.d(1),se=null),"html"===e[1]||"pdf"===e[1]?le?le.p(e,t):(le=Xe(e),le.c(),le.m(h,null)):le&&(le.d(1),le=null)},d(e){e&&p(t),se&&se.d(),le&&le.d(),re=!1,o(ie)}}}function Re(e){let t,n,o,r,i,s,l,a,c;return{c(){t=m("div"),n=m("label"),n.textContent="页面大小",o=f(),r=m("select"),i=m("option"),i.textContent="A4",s=m("option"),s.textContent="信纸 (Letter)",l=m("option"),l.textContent="法律页面 (Legal)",x(n,"for","paperSize"),x(n,"class","block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"),i.__value="a4",w(i,i.__value),s.__value="letter",w(s,s.__value),l.__value="legal",w(l,l.__value),x(r,"id","paperSize"),x(r,"class","w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"),void 0===e[5]&&O((()=>e[16].call(r)))},m(p,m){u(p,t,m),d(t,n),d(t,o),d(t,r),d(r,i),d(r,s),d(r,l),y(r,e[5],!0),a||(c=v(r,"change",e[16]),a=!0)},p(e,t){32&t&&y(r,e[5])},d(e){e&&p(t),a=!1,c()}}}function Xe(e){let t,n,o,r,i,s,l,a,c;return{c(){t=m("div"),n=m("label"),n.textContent="代码主题",o=f(),r=m("select"),i=m("option"),i.textContent="默认",s=m("option"),s.textContent="GitHub",l=m("option"),l.textContent="Monokai",x(n,"for","codeTheme"),x(n,"class","block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"),i.__value="default",w(i,i.__value),s.__value="github",w(s,s.__value),l.__value="monokai",w(l,l.__value),x(r,"id","codeTheme"),x(r,"class","w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"),void 0===e[6]&&O((()=>e[17].call(r)))},m(p,m){u(p,t,m),d(t,n),d(t,o),d(t,r),d(r,i),d(r,s),d(r,l),y(r,e[6],!0),a||(c=v(r,"change",e[17]),a=!0)},p(e,t){64&t&&y(r,e[6])},d(e){e&&p(t),a=!1,c()}}}function Fe(t){let n,o,r,i=t[0]&&Pe(t);return{c(){i&&i.c(),n=b()},m(e,s){i&&i.m(e,s),u(e,n,s),o||(r=v(window,"keydown",t[9]),o=!0)},p(e,[t]){e[0]?i?i.p(e,t):(i=Pe(e),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i:e,o:e,d(e){e&&p(n),i&&i.d(e),o=!1,r()}}}function Ue(e,t,n){let{isOpen:o=!1}=t,r="markdown",i=!0,s="document",l=!1,a="a4",c="default";const d=M();var u;function p(){console.log("关闭导出对话框"),n(0,o=!1)}u=()=>{console.log("ExportDialog update, isOpen =",o)},E().$$.after_update.push(u),L((()=>{console.log("ExportDialog mounted with isOpen =",o),n(0,o=!1),setTimeout((()=>{o&&(console.log("Forcing dialog to close during mount"),n(0,o=!1))}),200)}));return e.$$set=e=>{"isOpen"in e&&n(0,o=e.isOpen)},[o,r,i,s,l,a,c,p,function(){console.log("执行导出操作"),d("export",{format:r,includeStyles:i,filename:s,includeToc:l,paperSize:a,codeTheme:c}),p()},function(e){"Escape"===e.key&&o&&p()},()=>n(1,r="markdown"),()=>n(1,r="html"),()=>n(1,r="pdf"),function(){s=this.value,n(3,s)},function(){i=this.checked,n(2,i)},function(){l=this.checked,n(4,l)},function(){a=$(this),n(5,a)},function(){c=$(this),n(6,c)}]}class Ve extends Z{constructor(e){super(),Q(this,e,Ue,Fe,i,{isOpen:0})}}function We(e){let t,n,r,i,s,l,a,c,h,g,b,k,w,y,$,j,C,S,E,L,M,_,B,I,z;function H(t){e[14](t)}r=new Le({props:{editorReady:e[4]}}),r.$on("action",e[10]);let O={};function N(t){e[15](t)}void 0!==e[3]&&(O.isOpen=e[3]),S=new Ae({props:O}),T.push((()=>q(S,"isOpen",H)));let A={};return void 0!==e[5]&&(A.isOpen=e[5]),M=new Ve({props:A}),T.push((()=>q(M,"isOpen",N))),M.$on("export",e[9]),{c(){t=m("div"),n=m("div"),K(r.$$.fragment),i=f(),s=m("div"),l=m("button"),l.textContent="导出",a=f(),c=m("button"),c.textContent="设置",h=f(),g=m("div"),b=m("div"),k=m("textarea"),y=f(),$=m("div"),j=m("div"),C=f(),K(S.$$.fragment),L=f(),K(M.$$.fragment),x(l,"class","export-btn svelte-ocgk1p"),x(l,"title","导出文档"),x(c,"class","settings-btn svelte-ocgk1p"),x(c,"title","打开设置"),x(s,"class","buttons-container svelte-ocgk1p"),x(n,"class","toolbar-container svelte-ocgk1p"),x(n,"id","markdown-toolbar"),x(k,"class","editor-textarea svelte-ocgk1p"),k.value=w=e[6].currentContent||qe,x(b,"class","editor-panel svelte-ocgk1p"),x(j,"class","prose dark:prose-invert max-w-none preview-content svelte-ocgk1p"),x($,"class","preview-panel svelte-ocgk1p"),x(g,"class","panels-container svelte-ocgk1p"),x(t,"class","editor-container svelte-ocgk1p"),x(t,"id","editor-root-container")},m(o,p){u(o,t,p),d(t,n),J(r,n,null),d(n,i),d(n,s),d(s,l),d(s,a),d(s,c),d(t,h),d(t,g),d(g,b),d(b,k),e[12](b),d(g,y),d(g,$),d($,j),j.innerHTML=e[2],e[13]($),u(o,C,p),J(S,o,p),u(o,L,p),J(M,o,p),B=!0,I||(z=[v(l,"click",e[8]),v(c,"click",e[7]),v(k,"input",e[11])],I=!0)},p(e,[t]){const n={};16&t&&(n.editorReady=e[4]),r.$set(n),(!B||64&t&&w!==(w=e[6].currentContent||qe))&&(k.value=w),(!B||4&t)&&(j.innerHTML=e[2]);const o={};!E&&8&t&&(E=!0,o.isOpen=e[3],D((()=>E=!1))),S.$set(o);const i={};!_&&32&t&&(_=!0,i.isOpen=e[5],D((()=>_=!1))),M.$set(i)},i(e){B||(U(r.$$.fragment,e),U(S.$$.fragment,e),U(M.$$.fragment,e),B=!0)},o(e){V(r.$$.fragment,e),V(S.$$.fragment,e),V(M.$$.fragment,e),B=!1},d(n){n&&(p(t),p(C),p(L)),Y(r),e[12](null),e[13](null),Y(S,n),Y(M,n),I=!1,o(z)}}}const qe="# 欢迎使用 MarkTeX 编辑器\n\n这是一个简化版编辑器。";function Ke(e,t,n){let o,r,i;l(e,xe,(e=>n(6,o=e)));let s="",a=!1,c=!1,d=!1;function u(e){n(2,s=ke(e))}return L((()=>{console.log("编辑器组件已挂载"),n(5,d=!1),setTimeout((()=>{d&&(console.log("强制关闭导出对话框"),n(5,d=!1))}),100);const e=document.getElementById("markdown-toolbar");document.getElementById("editor-root-container");const t=document.getElementById("app-main-container");e&&t&&t.addEventListener("scroll",(()=>{e.getBoundingClientRect().top<0?e.classList.add("toolbar-sticky"):e.classList.remove("toolbar-sticky")}));const r=e=>{console.log("收到导出文档事件")};return window.addEventListener("export-document",r),n(4,c=!0),o.currentContent||xe.updateContent(qe),u(o.currentContent||qe),()=>{window.removeEventListener("export-document",r)}})),[r,i,s,a,c,d,o,function(){n(3,a=!0)},function(){console.log("Opening export dialog (before):",d),n(5,d=!0),console.log("Opening export dialog (after):",d)},function(e){const{format:t,includeStyles:n,filename:r,includeToc:i,paperSize:s,codeTheme:l}=e.detail;console.log("处理导出:",t,r);const a=ke(o.currentContent||qe);if("html"===t){const e=new Blob([`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>${r}</title>\n  ${'<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">'}\n  ${n?"<style>\n            body {\n              font-family: system-ui, -apple-system, sans-serif;\n              line-height: 1.6;\n              max-width: 800px;\n              margin: 0 auto;\n              padding: 20px;\n              color: #333;\n            }\n            h1, h2, h3 { margin-top: 1.5em; }\n            pre {\n              background: #f5f5f5;\n              padding: 10px;\n              border-radius: 4px;\n              overflow-x: auto;\n            }\n            /* 表格样式 */\n            .table-container {\n              max-width: 100%;\n              overflow-x: auto;\n              margin: 1rem 0;\n              border-radius: 4px;\n            }\n            .md-table {\n              border-collapse: collapse;\n              width: 100%;\n              font-size: 0.9em;\n              margin-bottom: 1rem;\n            }\n            .md-table th {\n              background-color: #f3f4f6;\n              padding: 8px;\n              text-align: left;\n              border-bottom: 2px solid #ddd;\n            }\n            .md-table td {\n              padding: 8px;\n              border-bottom: 1px solid #ddd;\n            }\n            .md-table tr:nth-child(even) {\n              background-color: #f9fafb;\n            }\n            /* 公式样式 */\n            .math-block {\n              background-color: #f8fafc;\n              padding: 1rem;\n              border-radius: 6px;\n              margin: 1.5rem 0;\n              overflow-x: auto;\n            }\n            .math-inline {\n              background-color: #f1f5f9;\n              border-radius: 4px;\n              padding: 0.1em 0.2em;\n            }\n            .katex-display {\n              margin: 1.5rem 0;\n              overflow-x: auto;\n              overflow-y: hidden;\n            }\n            .katex {\n              font-size: 1.1em;\n            }\n          </style>":""}\n  ${'<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"><\/script>'}\n  ${"<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js\" onload=\"renderMathInElement(document.body, {delimiters: [{left: '\\\\$\\\\$', right: '\\\\$\\\\$', display: true}, {left: '\\\\$', right: '\\\\$', display: false}]});\"><\/script>"}\n</head>\n<body>\n  ${i?'<div class="toc"><h2>目录</h2>...</div>':""}\n  ${a}\n</body>\n</html>`],{type:"text/html"}),t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download=`${r}.html`,o.click(),URL.revokeObjectURL(t)}else if("pdf"===t){const e=window.open("","_blank"),t='<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">',n='<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"><\/script>',o="<script defer src=\"https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js\" onload=\"renderMathInElement(document.body, {delimiters: [{left: '\\\\$\\\\$', right: '\\\\$\\\\$', display: true}, {left: '\\\\$', right: '\\\\$', display: false}]});\"><\/script>";let l="";l="letter"===s?"\n          <style>\n            /* Letter paper size */\n            @page { size: letter; }\n            body { \n              font-family: system-ui, -apple-system, sans-serif; \n              line-height: 1.6; \n              color: #333;\n              margin: 2cm;\n            }\n            h1, h2, h3 { margin-top: 1.5em; }\n            pre { \n              background: #f5f5f5; \n              padding: 10px; \n              border-radius: 4px; \n              overflow-x: auto; \n            }\n            /* 表格样式 */\n            .table-container {\n              max-width: 100%;\n              overflow-x: auto;\n              margin: 1rem 0;\n              page-break-inside: avoid;\n            }\n            .md-table {\n              border-collapse: collapse;\n              width: 100%;\n              font-size: 0.9em;\n              margin-bottom: 1rem;\n            }\n            .md-table th {\n              background-color: #f3f4f6;\n              padding: 8px;\n              text-align: left;\n              border-bottom: 2px solid #ddd;\n            }\n            .md-table td {\n              padding: 8px;\n              border-bottom: 1px solid #ddd;\n            }\n            .md-table tr:nth-child(even) {\n              background-color: #f9fafb;\n            }\n            /* 公式样式 */\n            .math-block {\n              background-color: #f8fafc;\n              padding: 1rem;\n              border-radius: 6px;\n              margin: 1.5rem 0;\n              overflow-x: auto;\n            }\n            .math-inline {\n              background-color: #f1f5f9;\n              border-radius: 4px;\n              padding: 0.1em 0.2em;\n            }\n            .katex-display {\n              margin: 1.5rem 0;\n              overflow-x: auto;\n              overflow-y: hidden;\n            }\n            .katex {\n              font-size: 1.1em;\n            }\n          </style>\n        ":"legal"===s?"\n          <style>\n            /* Legal paper size */\n            @page { size: legal; }\n            body { \n              font-family: system-ui, -apple-system, sans-serif; \n              line-height: 1.6; \n              color: #333;\n              margin: 2cm;\n            }\n            h1, h2, h3 { margin-top: 1.5em; }\n            pre { \n              background: #f5f5f5; \n              padding: 10px; \n              border-radius: 4px; \n              overflow-x: auto; \n            }\n            /* 表格样式 */\n            .table-container {\n              max-width: 100%;\n              overflow-x: auto;\n              margin: 1rem 0;\n              page-break-inside: avoid;\n            }\n            .md-table {\n              border-collapse: collapse;\n              width: 100%;\n              font-size: 0.9em;\n              margin-bottom: 1rem;\n            }\n            .md-table th {\n              background-color: #f3f4f6;\n              padding: 8px;\n              text-align: left;\n              border-bottom: 2px solid #ddd;\n            }\n            .md-table td {\n              padding: 8px;\n              border-bottom: 1px solid #ddd;\n            }\n            .md-table tr:nth-child(even) {\n              background-color: #f9fafb;\n            }\n            /* 公式样式 */\n            .math-block {\n              background-color: #f8fafc;\n              padding: 1rem;\n              border-radius: 6px;\n              margin: 1.5rem 0;\n              overflow-x: auto;\n            }\n            .math-inline {\n              background-color: #f1f5f9;\n              border-radius: 4px;\n              padding: 0.1em 0.2em;\n            }\n            .katex-display {\n              margin: 1.5rem 0;\n              overflow-x: auto;\n              overflow-y: hidden;\n            }\n            .katex {\n              font-size: 1.1em;\n            }\n          </style>\n        ":"\n          <style>\n            /* A4 paper size */\n            @page { size: A4; }\n            body { \n              font-family: system-ui, -apple-system, sans-serif; \n              line-height: 1.6; \n              color: #333;\n              margin: 2cm;\n            }\n            h1, h2, h3 { margin-top: 1.5em; }\n            pre { \n              background: #f5f5f5; \n              padding: 10px; \n              border-radius: 4px; \n              overflow-x: auto; \n            }\n            /* 表格样式 */\n            .table-container {\n              max-width: 100%;\n              overflow-x: auto;\n              margin: 1rem 0;\n              page-break-inside: avoid;\n            }\n            .md-table {\n              border-collapse: collapse;\n              width: 100%;\n              font-size: 0.9em;\n              margin-bottom: 1rem;\n            }\n            .md-table th {\n              background-color: #f3f4f6;\n              padding: 8px;\n              text-align: left;\n              border-bottom: 2px solid #ddd;\n            }\n            .md-table td {\n              padding: 8px;\n              border-bottom: 1px solid #ddd;\n            }\n            .md-table tr:nth-child(even) {\n              background-color: #f9fafb;\n            }\n            /* 公式样式 */\n            .math-block {\n              background-color: #f8fafc;\n              padding: 1rem;\n              border-radius: 6px;\n              margin: 1.5rem 0;\n              overflow-x: auto;\n            }\n            .math-inline {\n              background-color: #f1f5f9;\n              border-radius: 4px;\n              padding: 0.1em 0.2em;\n            }\n            .katex-display {\n              margin: 1.5rem 0;\n              overflow-x: auto;\n              overflow-y: hidden;\n            }\n            .katex {\n              font-size: 1.1em;\n            }\n          </style>\n        ",e.document.write(`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>${r}</title>\n  ${t}\n  ${l}\n  ${n}\n  ${o}\n</head>\n<body>\n  ${i?'<div class="toc"><h2>目录</h2>...</div>':""}\n  ${a}\n</body>\n</html>`),e.document.close(),setTimeout((()=>{e.print(),e.close()}),1e3)}else{const e=new Blob([o.currentContent||qe],{type:"text/markdown"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`${r}.md`,n.click(),URL.revokeObjectURL(t)}},function(e){const{action:t,placeholder:n}=e.detail;if(console.log(`工具栏动作: ${t}`,n),!c)return void console.log("编辑器未就绪，无法执行操作");const o=r.querySelector("textarea");if(!o)return void console.error("无法找到编辑区域");const i=o.selectionStart,s=o.selectionEnd,l=o.value.substring(i,s),a=o.value.substring(0,i),d=o.value.substring(s);let u="",p=0;switch(t){case"bold":u=a+"**"+(l||"粗体文本")+"**"+d,p=l?i+l.length+4:i+8;break;case"italic":u=a+"*"+(l||"斜体文本")+"*"+d,p=l?i+l.length+2:i+6;break;case"strikethrough":u=a+"~~"+(l||"删除线文本")+"~~"+d,p=l?i+l.length+4:i+8;break;case"code":u=a+"`"+(l||"代码")+"`"+d,p=l?i+l.length+2:i+4;break;case"link":u=a+"["+(l||"链接文本")+"](https://example.com)"+d,p=l?i+l.length+3:i+11;break;case"image":u=a+"!["+(l||"图片描述")+"](https://example.com/image.jpg)"+d,p=i+u.length-d.length;break;case"table":const e="\n| 标题1 | 标题2 | 标题3 |\n| ------- | ------- | ------- |\n| 单元格1 | 单元格2 | 单元格3 |\n| 单元格4 | 单元格5 | 单元格6 |\n";u=a+e+d,p=i+e.length;break;case"formula":u=a+"$"+(l||"E = mc^2")+"$"+d,p=l?i+l.length+2:i+10;break;case"bulletList":u=a+"\n- "+(l||"列表项目")+"\n- 另一个项目\n"+d,p=i+u.length-d.length;break;case"numberedList":u=a+"\n1. "+(l||"第一项")+"\n2. 第二项\n"+d,p=i+u.length-d.length;break;case"taskList":u=a+"\n- [ ] "+(l||"待办事项")+"\n- [x] 已完成事项\n"+d,p=i+u.length-d.length;break;case"heading":u=a+"\n## "+(l||"标题")+"\n"+d,p=i+u.length-d.length-1;break;default:u=a+n+d,p=i+n.length}o.value=u,o.focus(),o.setSelectionRange(p,p);const m=new Event("input",{bubbles:!0});o.dispatchEvent(m)},function(e){const t=e.target.value;xe.updateContent(t),u(t)},function(e){T[e?"unshift":"push"]((()=>{r=e,n(0,r)}))},function(e){T[e?"unshift":"push"]((()=>{i=e,n(1,i)}))},function(e){a=e,n(3,a)},function(e){d=e,n(5,d)}]}class Je extends Z{constructor(e){super(),Q(this,e,Ke,We,i,{})}}const Ye=(()=>{const{subscribe:e,update:t,set:n}=te({theme:"light"});return{subscribe:e,setTheme:e=>{try{localStorage.setItem("marktex-theme",e)}catch(t){console.warn("Failed to save theme preference to localStorage:",t)}n({theme:e})},toggleTheme:()=>{t((e=>{const t="light"===e.theme?"dark":"light";try{localStorage.setItem("marktex-theme",t)}catch(n){console.warn("Failed to save theme preference to localStorage:",n)}return{theme:t}}))},initialize:()=>{try{const e=localStorage.getItem("marktex-theme");e&&n({theme:e})}catch(e){console.warn("Failed to load theme preference from localStorage:",e)}}}})();function Ge(e){let t;return{c(){t=m("span"),t.textContent="Saved",x(t,"class","text-accent dark:text-accent-dark")},m(e,n){u(e,t,n)},d(e){e&&p(t)}}}function Qe(t){let n,o,r,i,s,l,a,c,h,g,b,k,w;let y=Ge(t);return{c(){n=m("header"),o=m("div"),r=m("div"),r.innerHTML='<div class="font-bold text-xl text-primary dark:text-primary-dark">MarkTeX</div> <div class="text-sm text-neutral/60 dark:text-neutral-dark/60">Editor</div>',i=f(),s=m("div"),l=m("div"),a=m("span"),a.textContent="Status:",c=f(),y.c(),h=f(),g=m("div"),b=m("button"),b.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg> <span class="hidden md:inline">Export</span>',x(r,"class","flex items-center gap-3"),x(l,"class","hidden md:flex items-center gap-1 text-sm"),x(s,"class","flex items-center gap-2"),x(b,"class","btn-secondary text-sm flex items-center gap-1"),x(b,"title","Export Markdown"),x(g,"class","flex items-center gap-3"),x(o,"class","w-full px-4 py-2 flex items-center justify-between"),x(n,"class","w-full bg-base-100 dark:bg-base-100-dark shadow-sm border-b border-base-300 dark:border-base-300-dark flex-shrink-0")},m(e,t){u(e,n,t),d(n,o),d(o,r),d(o,i),d(o,s),d(s,l),d(l,a),d(l,c),y.m(l,null),d(o,h),d(o,g),d(g,b),k||(w=v(b,"click",Ze),k=!0)},p:e,i:e,o:e,d(e){e&&p(n),y.d(),k=!1,w()}}}function Ze(){console.log("Header: Export button clicked");const e=new CustomEvent("export-document");window.dispatchEvent(e)}function et(e){return L((()=>{console.log("Header component mounted")})),[]}class tt extends Z{constructor(e){super(),Q(this,e,et,Qe,i,{})}}function nt(t){let n,o,r,i,s,l;return{c(){n=m("footer"),o=m("div"),r=m("div"),i=m("div"),i.textContent=`© ${t[0]} MarkTeX Editor`,s=f(),l=m("div"),l.innerHTML='<div class="flex items-center gap-2"><span>Powered by</span> <a href="https://svelte.dev" target="_blank" rel="noopener" class="hover:text-primary dark:hover:text-primary-dark transition-colors">Svelte</a> <span>•</span> <a href="https://codemirror.net" target="_blank" rel="noopener" class="hover:text-primary dark:hover:text-primary-dark transition-colors">CodeMirror</a> <span>•</span> <a href="https://katex.org" target="_blank" rel="noopener" class="hover:text-primary dark:hover:text-primary-dark transition-colors">KaTeX</a></div>',x(i,"class","text-sm text-neutral/60 dark:text-neutral-dark/60"),x(l,"class","text-xs text-neutral/40 dark:text-neutral-dark/40"),x(r,"class","flex flex-col md:flex-row justify-between items-center gap-2"),x(o,"class","w-full px-4 py-2"),x(n,"class","w-full bg-base-100 dark:bg-base-100-dark shadow-inner border-t border-base-300 dark:border-base-300-dark mt-auto flex-shrink-0")},m(e,t){u(e,n,t),d(n,o),d(o,r),d(r,i),d(r,s),d(r,l)},p:e,i:e,o:e,d(e){e&&p(n)}}}function ot(e){return[(new Date).getFullYear()]}class rt extends Z{constructor(e){super(),Q(this,e,ot,nt,i,{})}}function it(e){let t,n;return{c(){t=h("svg"),n=h("path"),x(n,"stroke-linecap","round"),x(n,"stroke-linejoin","round"),x(n,"stroke-width","2"),x(n,"d","M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"),x(t,"xmlns","http://www.w3.org/2000/svg"),x(t,"class","h-6 w-6 text-neutral-dark"),x(t,"fill","none"),x(t,"viewBox","0 0 24 24"),x(t,"stroke","currentColor")},m(e,o){u(e,t,o),d(t,n)},d(e){e&&p(t)}}}function st(e){let t,n;return{c(){t=h("svg"),n=h("path"),x(n,"stroke-linecap","round"),x(n,"stroke-linejoin","round"),x(n,"stroke-width","2"),x(n,"d","M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"),x(t,"xmlns","http://www.w3.org/2000/svg"),x(t,"class","h-6 w-6 text-neutral"),x(t,"fill","none"),x(t,"viewBox","0 0 24 24"),x(t,"stroke","currentColor")},m(e,o){u(e,t,o),d(t,n)},d(e){e&&p(t)}}}function lt(t){let n,o,r,i,s;function l(e,t){return"light"===e[0].theme?st:it}let a=l(t),c=a(t);return{c(){n=m("button"),c.c(),x(n,"class","w-12 h-12 rounded-full bg-base-100 dark:bg-base-100-dark shadow-md flex items-center justify-center hover:shadow-lg transition-all duration-200"),x(n,"title",o="light"===t[0].theme?"Switch to dark mode":"Switch to light mode"),x(n,"aria-label",r="light"===t[0].theme?"Switch to dark mode":"Switch to light mode")},m(e,o){u(e,n,o),c.m(n,null),i||(s=v(n,"click",t[1]),i=!0)},p(e,[t]){a!==(a=l(e))&&(c.d(1),c=a(e),c&&(c.c(),c.m(n,null))),1&t&&o!==(o="light"===e[0].theme?"Switch to dark mode":"Switch to light mode")&&x(n,"title",o),1&t&&r!==(r="light"===e[0].theme?"Switch to dark mode":"Switch to light mode")&&x(n,"aria-label",r)},i:e,o:e,d(e){e&&p(n),c.d(),i=!1,s()}}}function at(e,t,n){let o;return l(e,Ye,(e=>n(0,o=e))),[o,function(){Ye.toggleTheme()}]}class ct extends Z{constructor(e){super(),Q(this,e,at,lt,i,{})}}const{document:dt}=c;function ut(t){let n;return{c(){n=m("div"),n.innerHTML='<div class="spinner"></div>',x(n,"class","w-full h-full flex items-center justify-center")},m(e,t){u(e,n,t)},i:e,o:e,d(e){e&&p(n)}}}function pt(e){let t,n;return t=new Je({}),{c(){K(t.$$.fragment)},m(e,o){J(t,e,o),n=!0},i(e){n||(U(t.$$.fragment,e),n=!0)},o(e){V(t.$$.fragment,e),n=!1},d(e){Y(t,e)}}}function mt(e){let t,n,r,i,l,a,c,h,g,b,v,k,w,y,$,j,C;c=new tt({});const S=[pt,ut],E=[];function L(e,t){return e[0]&&e[1]?0:1}return b=L(e),v=E[b]=S[b](e),y=new ct({}),j=new rt({}),{c(){var e,o;t=m("meta"),n=m("link"),r=m("script"),r.innerHTML="",l=f(),a=m("main"),K(c.$$.fragment),h=f(),g=m("div"),v.c(),k=f(),w=m("div"),K(y.$$.fragment),$=f(),K(j.$$.fragment),dt.title="MarkTeX - Markdown & LaTeX 编辑器",x(t,"name","description"),x(t,"content","MarkTeX是一个强大的Markdown和LaTeX公式编辑器，支持实时预览和多种导出格式。"),x(n,"rel","stylesheet"),x(n,"href","https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"),r.defer=!0,e=r.src,o=i="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js",e!==o&&(s||(s=document.createElement("a")),s.href=o,e!==s.href)&&x(r,"src","https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"),x(g,"class","flex-grow overflow-auto"),x(g,"id","app-main-container"),x(w,"class","fixed bottom-6 right-6 z-50"),x(a,"class","min-h-screen h-screen flex flex-col w-full bg-base-200 dark:bg-base-200-dark text-neutral dark:text-neutral-dark font-sans transition-colors duration-200 overflow-hidden")},m(e,o){d(dt.head,t),d(dt.head,n),d(dt.head,r),u(e,l,o),u(e,a,o),J(c,a,null),d(a,h),d(a,g),E[b].m(g,null),d(a,k),d(a,w),J(y,w,null),d(a,$),J(j,a,null),C=!0},p(e,[t]){let n=b;b=L(e),b!==n&&(F={r:0,c:[],p:F},V(E[n],1,1,(()=>{E[n]=null})),F.r||o(F.c),F=F.p,v=E[b],v||(v=E[b]=S[b](e),v.c()),U(v,1),v.m(g,null))},i(e){C||(U(c.$$.fragment,e),U(v),U(y.$$.fragment,e),U(j.$$.fragment,e),C=!0)},o(e){V(c.$$.fragment,e),V(v),V(y.$$.fragment,e),V(j.$$.fragment,e),C=!1},d(e){e&&(p(l),p(a)),p(t),p(n),p(r),Y(c),E[b].d(),Y(y),Y(j)}}}function ht(e,t,n){let o;l(e,Ye,(e=>n(2,o=e)));let r=!1,i=!1;function s(){if("undefined"!=typeof window&&void 0!==window.katex)return void n(0,r=!0);const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css",document.head.appendChild(e);const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js",t.async=!0,t.onload=()=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js",e.async=!0,e.onload=()=>{window.renderMathInElement&&window.renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]}),n(0,r=!0)},document.head.appendChild(e)},document.head.appendChild(t)}return L((()=>{console.log("App组件已挂载");const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;("dark"===e||!e&&t)&&document.documentElement.classList.add("dark"),function(){const e=document.createElement("link");e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap",document.head.appendChild(e)}(),s();const o=setInterval((()=>{r&&(clearInterval(o),setTimeout((()=>{n(1,i=!0)}),300))}),100)})),e.$$.update=()=>{4&e.$$.dirty&&("dark"===o.theme?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"))},[r,i,o]}console.info('\n===========================================\nMarkTeX 编辑器启动\n===========================================\n如果您无法通过 npm run dev 运行应用，可能是 PowerShell 安全策略问题。\n请尝试以下方法之一：\n\n1. 使用 CMD 而不是 PowerShell 运行命令：\n   cmd /c "npm run dev"\n\n2. 以管理员身份运行 PowerShell 并执行：\n   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser\n   \n3. 双击打开 index.html 文件直接在浏览器中运行\n===========================================\n');const gt=console.error;console.error=function(...e){const t=e[0]?.toString()||"";if(t.includes("Editor instance not initialized")){console.warn("编辑器正在初始化中，请稍候再试...");const e=document.querySelector(".editor-loading-indicator");e&&e instanceof HTMLElement&&(e.style.display="block")}else t.includes("Receiving end does not exist")||t.includes("videoInWhiteList")||t.includes("WebAssembly.instantiate")||gt.apply(console,e)},window.addEventListener("error",(e=>{if(e.message&&e.message.includes("Editor"))return e.preventDefault(),console.warn("编辑器初始化问题：",e.message),void document.querySelector(".editor-error-message");const t=document.createElement("div");t.style.position="fixed",t.style.top="10px",t.style.left="10px",t.style.right="10px",t.style.padding="20px",t.style.backgroundColor="#ffebee",t.style.border="1px solid #ef5350",t.style.borderRadius="4px",t.style.zIndex="9999",t.innerHTML=`\n    <h3 style="margin-top: 0; color: #d32f2f;">应用程序启动错误</h3>\n    <p><strong>错误信息:</strong> ${e.message||"未知错误"}</p>\n    <p><strong>解决方案:</strong></p>\n    <ol>\n      <li>请确保已运行 fix-project.js 脚本: <code>node fix-project.js</code></li>\n      <li>尝试使用 CMD 而不是 PowerShell 运行: <code>cmd /c "npm run dev"</code></li>\n      <li>清除浏览器缓存后重试</li>\n      <li>检查浏览器控制台获取更多详细信息</li>\n    </ol>\n    <button style="padding: 8px 16px; background-color: #d32f2f; color: white; border: none; border-radius: 4px; cursor: pointer;" onclick="this.parentNode.remove()">关闭</button>\n  `,document.body.appendChild(t)}));const ft=document.querySelector(".initial-loader");ft&&(ft.classList.add("opacity-0"),ft instanceof HTMLElement&&(ft.style.transition="opacity 0.3s ease-out"),setTimeout((()=>{ft.remove()}),300)),new class extends Z{constructor(e){super(),Q(this,e,ht,mt,i,{})}}({target:document.getElementById("app")});
